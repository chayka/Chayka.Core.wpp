{"version":3,"sources":["chayka-options-form.js","chayka-wp-admin.js"],"names":["angular","module","controller","$scope","$timeout","ajax","namespace","options","site","validator","processResponse","data","forEach","payload","value","option","saveOptions","validateFields","post","spinnerMessage","success","loadOptions","meta","factory","queue","multiQueue","cache","bulkDelay","bulkTimeout","resolver","resolveById","id","callback","delay","push","clearTimeout","setTimeout","bulkResolveById","resolveByIds","ids","idsArr","unresolvedIds","resolvedItems","isString","split","parseInt","isArray","i","length","requestQueue","requestMultiQueue","requestedIds","hasOwnProperty","itemSet","post_type","post__in","post_status","posts_per_page","errorMessage","items","item","callbacks","directive","buttons","mediaResolver","nls","modals","restrict","scope","title","pickerButtonText","type","mode","model","size","multiple","itemWidth","itemHeight","itemMode","onChange","transclude","template","$element","buttonClass","getButtonClass","mediaSrc","mediaItems","spinner","prevModel","frame","wp","window","JSON","stringify","$watch","show","_","hide","url","image","thumbnail","newModel","dragControl","orderChanged","event","updateMultiModel","scrollableContainer","attr","hasImages","removeMediaItem","$event","preventDefault","confirm","re","RegExp","replace","trim","values","join","pickMedia","$el","remove","media","button","text","on","selection","state","get","add","attachment","attachments","toJSON","first","$apply","open","clearMedia","utils","defaultColor","palettes","link","element","attrs","$","onPickerColorChange","change","$parent","ngModel","color","toString","fn","wpColorPicker","$input","insertAfter","val","clear","$inputDiv","parent","$pickerContainer","find","off","keyCode","stopPropagation","jobControl","jobId","perIteration","controllerAs","ctrl","total","processed","log","setJobId","getJobId","setPerIteration","getPerIteration","setTotal","getTotal","setProcessed","getProcessed","isFinished","setProgress","setState","getState","addLogMessage","message","clearLog","start","$emit","started","pause","paused","resume","resumed","stop","stopped","config","nlsProvider","buttonsProvider","setTranslations","btn_start","btn_stop","btn_pause","btn_resume","label_per_iteration","setButtonClass"],"mappings":"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","file":"ng-modules/chayka-admin.js","sourcesContent":["'use strict';\n\nangular.module('chayka-options-form', ['chayka-forms', 'chayka-wp-admin']).controller('optionsForm', ['$scope', '$timeout', 'ajax', function ($scope, $timeout, ajax) {\n\n    $scope.namespace = '';\n    $scope.options = {\n        site: {}\n    };\n    $scope.validator = null;\n\n    var processResponse = function processResponse(data) {\n        angular.forEach(data.payload, function (value, option) {\n            $scope.options[option] = value;\n        });\n        //$scope.options = data.payload;\n    };\n\n    $scope.saveOptions = function () {\n        if (!$scope.validator || $scope.validator.validateFields()) {\n            ajax.post('/api/options/set', {\n                namespace: $scope.namespace,\n                options: $scope.options\n            }, {\n                spinnerMessage: 'Saving options',\n                success: processResponse\n            });\n        }\n    };\n\n    $scope.loadOptions = function () {\n        ajax.post('/api/options/get', {\n            namespace: $scope.namespace,\n            options: $scope.options\n        }, {\n            spinnerMessage: 'Loading options',\n            success: processResponse\n        });\n    };\n\n    $timeout($scope.loadOptions, 0);\n}]);","'use strict';\n\nangular.module('chayka-wp-admin', ['chayka-spinners', 'chayka-nls', 'chayka-utils', 'chayka-buttons', 'chayka-forms', 'ui.sortable']).controller('metabox', ['$scope', function ($scope) {\n    $scope.meta = {};\n    $scope.validator = null;\n}]).controller('sidebar-widget-form', ['$scope', function ($scope) {\n    $scope.options = {};\n    $scope.validator = null;\n}]).factory('mediaResolver', ['ajax', function (ajax) {\n\n    var queue = {};\n\n    var multiQueue = [];\n\n    var cache = {};\n\n    var bulkDelay = 100;\n\n    var bulkTimeout = null;\n\n    var resolver = {\n\n        /**\n         * Resolve media object by API and pass it to callback.\n         * This function pushes request to the queue to perform bulk api call\n         * @param {int} id\n         * @param {function} callback\n         * @param {int} delay\n         */\n        resolveById: function resolveById(id, callback, delay) {\n            if (cache[id]) {\n                callback(cache[id]);\n                return;\n            }\n            if (!queue[id]) {\n                queue[id] = [];\n            }\n            queue[id].push(callback);\n            if (bulkTimeout) {\n                clearTimeout(bulkTimeout);\n            }\n            bulkTimeout = setTimeout(resolver.bulkResolveById, delay || bulkDelay);\n        },\n\n        /**\n         * Resolve media objects by API and pass it to callback.\n         * This function pushes request to the queue to perform bulk api call\n         * @param {array|string} ids\n         * @param {function} callback\n         * @param {int} delay\n         */\n        resolveByIds: function resolveByIds(ids, callback, delay) {\n            var idsArr;\n            var unresolvedIds = [];\n            var resolvedItems = [];\n            if (angular.isString(ids)) {\n                idsArr = [];\n                ids.split(' ').forEach(function (id) {\n                    idsArr.push(parseInt(id));\n                });\n            }\n            if (angular.isArray(ids)) {\n                idsArr = ids;\n            }\n\n            for (var i = 0; i < idsArr.length; i++) {\n                var id = parseInt(idsArr[i]);\n                idsArr[i] = id;\n                if (cache[id]) {\n                    resolvedItems.push(cache[id]);\n                } else {\n                    unresolvedIds.push(id);\n                }\n            }\n\n            if (!unresolvedIds.length) {\n                callback(resolvedItems);\n                return;\n            }\n\n            multiQueue.push({ ids: idsArr, callback: callback });\n            if (bulkTimeout) {\n                clearTimeout(bulkTimeout);\n            }\n            bulkTimeout = setTimeout(resolver.bulkResolveById, delay || bulkDelay);\n        },\n\n        /**\n         * Resolves all the enqueued media objects and fires all the needed callbacks\n         */\n        bulkResolveById: function bulkResolveById() {\n            var requestQueue = queue;\n            queue = {};\n            var requestMultiQueue = multiQueue;\n            multiQueue = [];\n            var ids = [];\n            var requestedIds = {};\n            for (var id in requestQueue) {\n                if (requestQueue.hasOwnProperty(id)) {\n                    ids.push(id);\n                    requestedIds[id] = true;\n                }\n            }\n            requestMultiQueue.forEach(function (itemSet) {\n                for (var i = 0; i < itemSet.ids.length; i++) {\n                    id = itemSet.ids[i];\n                    if (!cache[id] && !requestedIds[id]) {\n                        ids.push(id);\n                        requestedIds[id] = true;\n                    }\n                }\n            });\n\n            ajax.post('/api/post-models/', {\n                'post_type': 'attachment',\n                'post__in': ids,\n                'post_status': 'any',\n                'posts_per_page': -1\n            }, {\n                spinnerMessage: 'Retrieving media data',\n                errorMessage: 'Failed to retrieve media data',\n                success: function success(data) {\n                    var items = data.payload.items;\n                    items.forEach(function (item) {\n                        cache[item.id] = item;\n                        var callbacks = requestQueue[item.id];\n                        if (callbacks && callbacks.length) {\n                            for (var i = 0; i < callbacks.length; i++) {\n                                callbacks[i](item);\n                            }\n                        }\n                    });\n                    requestMultiQueue.forEach(function (itemSet) {\n                        var items = [],\n                            item,\n                            id;\n                        for (var i = 0; i < itemSet.ids.length; i++) {\n                            id = itemSet.ids[i];\n                            item = cache[id];\n                            if (item) {\n                                items.push(item);\n                            }\n                        }\n                        itemSet.callback(items);\n                    });\n                }\n            });\n        }\n    };\n\n    return resolver;\n}]).directive('mediaPicker', ['buttons', 'mediaResolver', 'nls', 'modals', function (buttons, mediaResolver, nls, modals) {\n    return {\n        restrict: 'AE',\n        scope: {\n            /**\n             * Picker popup title\n             */\n            title: '@?',\n\n            /**\n             * Picker button text (both popup and inline input)\n             */\n            pickerButtonText: '@?',\n\n            /**\n             * Media type: all, images, audio, video\n             */\n            type: '@?',\n\n            /**\n             * Value (model) mode: id|url|object\n             */\n            mode: '@',\n\n            /**\n             * Scope model that is being adjusted\n             */\n            model: '=',\n\n            /**\n             * Image size: thumbnail, medium, large, full.\n             * 'medium' by default, but downgraded to 'thumbnail' for non-image attachments\n             */\n            size: '@',\n\n            /**\n             * Is media picker able to select multiple items\n             */\n            multiple: '@?',\n\n            /**\n             * In case of multiple mode defines width of media item,\n             * If not defined uses item-height or 100px\n             */\n            itemWidth: '@?',\n\n            /**\n             * In case of multiple mode defines height of media item,\n             * If not defined uses item-width or 100px\n             */\n            itemHeight: '@?',\n\n            /**\n             * Item background mode:\n             * - contain\n             * - cover\n             */\n            itemMode: '@?',\n\n            /**\n             * On model change callback\n             */\n            onChange: '&?'\n        },\n        transclude: true,\n        template: '<div class=\"chayka-media_picker\" data-ng-class=\"{\\'image-set\\': hasImages(), multiple: multiple}\">' + '<img data-ng-src=\"{{mediaSrc}}\" data-ng-show=\"!!mediaSrc\" data-ng-click=\"pickMedia();\"/>' + '<div class=\"media_items sortable-row\" data-ng-show=\"mediaItems && mediaItems.length\" data-ng-model=\"mediaItems\" data-as-sortable=\"dragControl\" >' + '<div class=\"media_item\" data-ng-class=\"{contain: itemMode === \\'contain\\', cover: itemMode === \\'cover\\'}\" data-ng-repeat=\"item in mediaItems\" data-as-sortable-item style=\"background-image: {{\\'url(\\'+item.url+\\')\\'}}; width: {{itemWidth || itemHeight || \\'100px\\'}}; height: {{itemHeight || itemWidth || \\'100px\\'}};\">' + '<div class=\"sortable-handle\" data-as-sortable-item-handle>' + '<button class=\"btn_remove\" data-ng-click=\"removeMediaItem($event, item)\" data-no-drag ><span>&times;</span></button>' + '</div>' + '</div>' + '</div>' + '<div class=\"no_image\" data-ng-click=\"pickMedia();\" data-ng-show=\"!hasImages()\">' + '   <div data-spinner=\"spinner\"></div>' + '</div>' + '<div class=\"note\" data-ng-transclude></div>' + '<div class=\"buttons\">' + '   <button class=\"{{buttonClass}} btn_clear\" data-ng-click=\"clearMedia($event);\" data-ng-show=\"!!hasImages()\" >{{ \"Clear\" | nls}}</button>' + '   <button class=\"{{buttonClass}} btn_pick\" data-ng-click=\"pickMedia($event);\">{{ pickerButtonText || \"Browse\" | nls}}</button>' + '</div>' + '</div>',\n        controller: function controller($scope, $element) {\n            $scope.buttonClass = buttons.getButtonClass();\n            $scope.mediaSrc = null;\n            $scope.mediaItems = [];\n            $scope.mode = $scope.mode || 'id';\n            $scope.size = $scope.size || 'medium';\n            $scope.spinner = null;\n            $scope.prevModel = '';\n\n            var frame = null;\n            var wp = window.wp;\n\n            $scope.prevModel = $scope.model ? JSON.stringify($scope.model) : '';\n\n            /**\n             * Watch madel, request items by ids and render them\n             */\n            $scope.$watch('model', function (model) {\n                if ($scope.multiple) {\n                    switch ($scope.mode) {\n                        case 'id':\n                            $scope.mediaSrc = '';\n                            $scope.mediaItems = [];\n                            if (model) {\n                                if ($scope.spinner) {\n                                    $scope.spinner.show(nls._('Retrieving media data...'));\n                                }\n                                mediaResolver.resolveByIds(model, function (items) {\n                                    if ($scope.spinner) {\n                                        $scope.spinner.hide();\n                                    }\n                                    items.forEach(function (item) {\n                                        $scope.mediaItems.push({\n                                            id: item.id,\n                                            url: (item.image[$scope.size] || item.image.thumbnail).url\n                                        });\n                                    });\n                                });\n                            }\n                            break;\n                        case 'url':\n                            model.split(' ').forEach(function (url) {\n                                $scope.mediaItems.push({\n                                    id: 0,\n                                    url: url\n                                });\n                            });\n\n                            break;\n                    }\n                } else {\n                    switch ($scope.mode) {\n                        case 'id':\n                            $scope.mediaSrc = '';\n                            $scope.mediaItems = [];\n                            model = parseInt(model);\n                            if (model) {\n                                if ($scope.spinner) {\n                                    $scope.spinner.show(nls._('Retrieving media data...'));\n                                }\n                                mediaResolver.resolveById(model, function (item) {\n                                    if ($scope.spinner) {\n                                        $scope.spinner.hide();\n                                    }\n                                    //media = item;\n                                    $scope.mediaSrc = (item.image[$scope.size] || item.image.thumbnail).url;\n                                });\n                            }\n                            break;\n                        case 'url':\n                            $scope.mediaSrc = model;\n                            break;\n                    }\n                }\n\n                var newModel = model ? JSON.stringify(model) : '';\n                if ($scope.onChange && newModel !== $scope.prevModel) {\n                    $scope.onChange();\n                }\n\n                $scope.prevModel = newModel;\n            });\n\n            /**\n             * ng-sortable options\n             *\n             * @type {{orderChanged: Function, scrollableContainer: *}}\n             */\n            $scope.dragControl = {\n                //accept: function (sourceItemHandleScope, destSortableScope) {return true;},//override to determine drag is allowed or not. default is true.\n                //itemMoved: function (event) {},\n                orderChanged: function orderChanged(event) {\n                    $scope.updateMultiModel($scope.mediaItems);\n                },\n                //containerPositioning: 'absolute'\n                scrollableContainer: $element.attr('id') //optional param.\n            };\n\n            /**\n             * Check if images are stt\n             * @return {boolean}\n             */\n            $scope.hasImages = function () {\n                return !!$scope.mediaItems && !!$scope.mediaItems.length || !!$scope.mediaSrc;\n            };\n\n            /**\n             * Remover media item in multiple mode\n             * @param $event\n             * @param {{id: int, url: string}} item\n             */\n            $scope.removeMediaItem = function ($event, item) {\n                $event.preventDefault();\n                modals.confirm(nls._('Delete this item?'), function () {\n                    var value = '';\n                    switch ($scope.mode) {\n                        case 'id':\n                            value = item.id;\n                            break;\n                        case 'url':\n                            value = item.url;\n                            break;\n                    }\n                    var re = new RegExp('\\\\b' + value + '\\\\b\\\\s?');\n                    $scope.model = $scope.model.replace(re, '').trim();\n                });\n            };\n\n            /**\n             * Update model in multiple mode\n             *\n             * @param items\n             */\n            $scope.updateMultiModel = function (items) {\n                var values = [];\n                items.forEach(function (item) {\n                    switch ($scope.mode) {\n                        case 'id':\n                            values.push(item.id);\n                            break;\n                        case 'url':\n                            values.push(item.url);\n                            break;\n                    }\n                });\n                $scope.model = values.join(' ');\n            };\n\n            /**\n             * Pick media\n             * @param $event\n             */\n            $scope.pickMedia = function ($event) {\n                if ($event && $event.preventDefault) {\n                    $event.preventDefault();\n                }\n                if (frame) {\n                    frame.$el.remove();\n                }\n                if (true || !frame) {\n                    frame = wp.media({\n                        title: nls._($scope.title || 'Select or Upload Media'),\n                        button: {\n                            text: nls._($scope.pickerButtonText || 'Use this media')\n                        },\n                        multiple: $scope.multiple // Set to true to allow multiple files to be selected\n                    });\n\n                    frame.on('open', function () {\n                        if ($scope.mode === 'id') {\n                            var selection = frame.state().get('selection');\n                            if ($scope.model) {\n                                if ($scope.multiple) {\n                                    $scope.model.split(' ').forEach(function (id) {\n                                        selection.add(wp.media.attachment(id));\n                                    });\n                                } else {\n                                    selection.add(wp.media.attachment($scope.model));\n                                }\n                            }\n                        }\n                    });\n\n                    // When an image is selected in the media frame...\n                    frame.on('select', function () {\n                        // Get media attachment details from the frame state\n                        if ($scope.multiple) {\n                            var attachments = frame.state().get('selection').toJSON();\n                            $scope.updateMultiModel(attachments);\n                        } else {\n                            var attachment = frame.state().get('selection').first().toJSON();\n\n                            switch ($scope.mode) {\n                                case 'id':\n                                    $scope.model = attachment.id;\n                                    break;\n                                case 'url':\n                                    $scope.model = attachment.url;\n                                    break;\n                            }\n                        }\n                        $scope.$apply();\n                    });\n\n                    // Finally, open the modal on click\n                    frame.open();\n                    frame.$el.show();\n                }\n            };\n\n            /**\n             * Reset state to no media selected\n             *\n             * @param $event\n             */\n            $scope.clearMedia = function ($event) {\n                $event.preventDefault();\n                if ($scope.multiple && $scope.mediaItems.length > 3) {\n                    modals.confirm(nls._('Remove media items?'), function () {\n                        $scope.model = '';\n                    });\n                } else {\n                    $scope.model = '';\n                }\n            };\n        }\n    };\n}]).directive('colorPicker', ['utils', function (utils) {\n    return {\n        restrict: 'AE',\n        scope: {\n            defaultColor: '@?',\n            palettes: '=?'\n        },\n        link: function link($scope, element, attrs) {\n            var $ = angular.element,\n                $element = $(element);\n\n            var onPickerColorChange = function onPickerColorChange(event, change) {\n                setTimeout(function () {\n                    $scope.$parent.$apply(attrs.ngModel + '=\"' + (change && change.color.toString() || '') + '\";');\n                }, 0);\n            };\n            if ($.fn.wpColorPicker) {\n                $element.attr('type', 'hidden');\n                var $input = $('<input type=\"text\">').insertAfter(element).val($element.val()).wpColorPicker({\n                    defaultColor: $scope.defaultColor,\n                    hide: true,\n                    palettes: $scope.palettes,\n                    change: onPickerColorChange,\n                    clear: onPickerColorChange\n                });\n                $scope.$parent.$watch(attrs.ngModel, function (value) {\n                    if (value !== $input.val()) {\n                        $input.wpColorPicker('color', value);\n                    }\n                });\n                var $inputDiv = $element.parent(),\n                    $pickerContainer = $inputDiv.find('.wp-picker-container'),\n                    $pickerColorButton = $pickerContainer.find('.wp-color-result'),\n                    $pickerInputWrap = $pickerContainer.find('.wp-picker-input-wrap'),\n                    $pickerHolder = $pickerContainer.find('.wp-picker-holder');\n                $pickerContainer.off('keyup', '*');\n                $input.off('keyup').on('keyup', function (event) {\n                    if (event.keyCode === 13 || event.keyCode === 32) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                        //$pickerColorButton.trigger( 'click' );//.next().focus();\n                        $input.wpColorPicker('close');\n                    }\n                });\n\n                //$pickerColorButton.appendTo($inputDiv);\n            }\n        }\n    };\n}]).directive('jobControl', [function () {\n    return {\n        restrict: 'AE',\n        scope: {\n            jobControl: '=',\n            jobId: '=?',\n            perIteration: '=?',\n            buttons: '@?'\n        },\n        controllerAs: 'jc',\n        template: '<div class=\"chayka-job_control {{jc.state}}\">' + '   <div class=\"progressbar\">' + '       <div class=\"progress_label\">{{ jc.total ? jc.processed + \" / \" + jc.total + \" (\" + Math.floor(jc.processed / jc.total * 100) + \"%)\" : \"0%\" }}</div>' + '   </div>' + '   <div class=\"box_controls\">' + '       <button class=\"dashicons-before dashicons-controls-play button button-small button_start\" data-ng-click=\"jc.start()\" title=\"{{ \\'btn_start\\' | nls }}\" data-ng-show=\"!jc.state && jc.buttons.indexOf(\\'start\\') >= 0\"></button>' + '       <button class=\"dashicons-before dashicons-controls-pause button button-small button_pause\" data-ng-click=\"jc.pause()\" title=\"{{ \\'btn_pause\\' | nls }}\" data-ng-show=\"jc.state===\\'running\\' && jc.buttons.indexOf(\\'pause\\') >= 0\"></button>' + '       <button class=\"dashicons-before dashicons-controls-repeat button button-small button_resume\" data-ng-click=\"jc.resume()\" title=\"{{ \\'btn_resume\\' | nls }}\" data-ng-show=\"jc.state===\\'paused\\' && jc.buttons.indexOf(\\'resume\\') >= 0\"></button>' + '       <button class=\"dashicons-before dashicons-no button button-small button_stop\" data-ng-click=\"jc.stop()\" title=\"{{ \\'btn_stop\\' | nls }}\" data-ng-show=\"jc.state && jc.buttons.indexOf(\\'stop\\') >= 0\"></button>' + '       <span class=\"field_items_per_iteration\">' + '           <label>{{ \"label_per_iteration\" | nls }}</label>' + '           <input type=\"number\" data-ng-model=\"jc.perIteration\"/>' + '       </span>' + '   </div>' + '   <div data-spinner=\"spinner\"></div>' + '   <div class=\"box_output\">' + '       <div data-ng-repeat=\"message in jc.log track by $index\" class=\"message\">{{message}}</div>' + '   </div>' + '</div>',\n\n        controller: function controller($scope) {\n            var ctrl = {\n                jobId: $scope.jobId,\n                state: '',\n                perIteration: $scope.perIteration || 10,\n                total: 100,\n                processed: 0,\n                log: [],\n                buttons: $scope.buttons ? $scope.buttons.split(' ') : ['start', 'pause', 'resume', 'stop'],\n\n                setJobId: function setJobId(val) {\n                    ctrl.jobId = val;\n                    return ctrl;\n                },\n\n                getJobId: function getJobId() {\n                    return ctrl.jobId;\n                },\n\n                setPerIteration: function setPerIteration(val) {\n                    ctrl.perIteration = val;\n                    return ctrl;\n                },\n\n                getPerIteration: function getPerIteration() {\n                    return ctrl.perIteration;\n                },\n\n                setTotal: function setTotal(val) {\n                    ctrl.total = val;\n                    return ctrl;\n                },\n\n                getTotal: function getTotal() {\n                    return ctrl.total;\n                },\n\n                setProcessed: function setProcessed(val) {\n                    ctrl.processed = val;\n                    return ctrl;\n                },\n\n                getProcessed: function getProcessed() {\n                    return ctrl.processed;\n                },\n\n                isFinished: function isFinished() {\n                    return ctrl.getTotal() === ctrl.getProcessed();\n                },\n\n                setProgress: function setProgress(processed, total) {\n                    ctrl.setProcessed(processed);\n                    ctrl.setTotal(total || ctrl.getTotal() || 100);\n                    if (ctrl.isFinished()) {\n                        ctrl.setState('finished');\n                    }\n                    return ctrl;\n                },\n\n                setState: function setState(val) {\n                    ctrl.state = val;\n                    return ctrl;\n                },\n\n                getState: function getState() {\n                    return ctrl.state;\n                },\n\n                addLogMessage: function addLogMessage(message) {\n                    ctrl.log.push(message);\n                },\n\n                clearLog: function clearLog() {\n                    ctrl.log = [];\n                },\n\n                start: function start() {\n                    $scope.$emit('JobControl.start', ctrl.jobId);\n                },\n\n                started: function started() {\n                    ctrl.setState('running');\n                },\n\n                pause: function pause() {\n                    $scope.$emit('JobControl.pause', ctrl.jobId);\n                },\n\n                paused: function paused() {\n                    ctrl.setState('paused');\n                },\n\n                resume: function resume() {\n                    $scope.$emit('JobControl.resume', ctrl.jobId);\n                },\n\n                resumed: function resumed() {\n                    ctrl.setState('running');\n                },\n\n                stop: function stop() {\n                    $scope.$emit('JobControl.stop', ctrl.jobId);\n                },\n\n                stopped: function stopped() {\n                    ctrl.setState('');\n                }\n            };\n\n            $scope.jobControl = ctrl;\n\n            return ctrl;\n        }\n    };\n}]).config(['nlsProvider', 'buttonsProvider', function (nlsProvider, buttonsProvider) {\n\n    // Adding a translation table for the English language\n    nlsProvider.setTranslations('en-US', {\n        'btn_start': 'Start',\n        'btn_stop': 'Stop',\n        'btn_pause': 'Pause',\n        'btn_resume': 'Resume',\n        'label_per_iteration': 'Per iteration'\n    });\n\n    nlsProvider.setTranslations('ru-RU', {\n        'btn_start': 'Старт',\n        'btn_stop': 'Стоп',\n        'btn_pause': 'Пауза',\n        'btn_resume': 'Возобновить',\n        'label_per_iteration': 'За итерацию'\n    });\n\n    buttonsProvider.setButtonClass('button');\n}]);"],"sourceRoot":"/source/"}